{"config":{"sparqlEndpoint":"http://ldf.fi/viaf/sparql","pageSize":15,"matchQuery":"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX text: <http://jena.apache.org/text#>\nPREFIX pf: <http://jena.hpl.hp.com/ARQ/property#>\nPREFIX sf: <http://ldf.fi/similarity-functions#>\nPREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\nPREFIX emlos: <http://emlo.bodleian.ox.ac.uk/schema#>\nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX viafs: <http://viaf.org/viaf/terms#>\nPREFIX es: <http://eulersharp.sourceforge.net/2003/03swap/log-rules#>\nPREFIX vs: <http://www.w3.org/2003/06/sw-vocab-status/ns#>\nSELECT ?queryId ?entity (SAMPLE(?l) AS ?label) (GROUP_CONCAT(DISTINCT ?al;separator=\", \") AS ?Alternate_names) (CONCAT(\"<span style='background-color:red'>\",MAX(?bwarning),MAX(?dwarning),\"</span>\") AS ?Warnings) (GROUP_CONCAT(DISTINCT ?pl;separator=\", \") AS ?Nationality) (GROUP_CONCAT(DISTINCT ?rl;separator=\", \") AS ?Roles) (MAX(?sc) AS ?score) (CONCAT(\"<a href='\",STR(?entity),\"'>\",STR(?entity),\"</a>\") AS ?Link) {\n  { # QUERY\n    {\n      SELECT ?entity ?mlabel (SUM(?s)/COUNT(?s) AS ?sc) {\n        {\n          SELECT DISTINCT ?entity {\n            BIND(REPLACE(REPLACE(REPLACE(REPLACE(<QUERY>,\"([\\\\+\\\\-\\\\&\\\\|\\\\!\\\\(\\\\)\\\\{\\\\}\\\\[\\\\]\\\\/\\\\^\\\\\\\"\\\\~\\\\*\\\\?\\\\:\\\\\\\\])\",\"\\\\\\\\$1\"),\"^ +| +$\", \"\"),\", *\",\" \"),\"\\\\. \",\"* \") AS ?escapedQuery)\n            BIND(CONCAT(\"(\",?escapedQuery,\") OR (\",REPLACE(?escapedQuery,\"([^*]) +\",\"$1~ \"),\"~)\") AS ?queryTerm)\n            ?entity text:query ?queryTerm .\n            ?entity a crm:E21_Person .\n          }\n          LIMIT 30\n        }\n        ?entity rdfs:label|skos:prefLabel|skos:altLabel ?mlabel .\n        ?str pf:strSplit (<QUERY> \" \")\n        BIND(sf:levenshteinSubstring(?str,STR(?mlabel)) AS ?s)\n      } GROUP BY ?entity ?mlabel\n    }\n    BIND(<QUERY_ID> AS ?queryId)\n    FILTER(BOUND(?entity))\n    OPTIONAL {\n      ?entity viafs:dateOfDeath/crm:P82b_end_of_the_end ?dd .\n      BIND(IF(STRDT(REPLACE(<CELL_1>,\"-.*\",\"\"),xsd:integer)>YEAR(?dd),\"Died before! \",\"\") AS ?dwarning)\n    }\n    OPTIONAL {\n      ?entity viafs:dateOfBirth/crm:P82a_begin_of_the_begin ?bd .\n      BIND(IF(YEAR(?bd)>STRDT(REPLACE(<CELL_1>,\".*-\",\"\"),xsd:integer),\"Wasn't born! \",\"\") AS ?bwarning)\n    }\n  } # /QUERY\n  ?entity skos:prefLabel ?l .\n  OPTIONAL {\n    ?entity viafs:nationality/skos:prefLabel ?pl .\n  }\n  OPTIONAL {\n    ?entity viafs:role/skos:prefLabel ?rl .\n  }\n  OPTIONAL {\n    ?entity skos:altLabel ?al .\n  }\n}\nGROUP BY ?queryId ?entity\nORDER BY ?queryId DESC(?score)\n"},"state":null}